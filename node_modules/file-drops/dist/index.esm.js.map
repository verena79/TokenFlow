{"version":3,"file":"index.esm.js","sources":["../lib/index.js"],"sourcesContent":["import {\n  domify\n} from 'min-dom';\n\nvar OVERLAY_HTML = '<div class=\"drop-overlay\">' +\n                     '<div class=\"box\">' +\n                        '<div class=\"label\">{label}</div>' +\n                     '</div>' +\n                   '</div>';\n\n/**\n * Add file drop functionality to the given element,\n * calling fn(files...) on drop.\n *\n * @example\n *\n * var node = document.querySelector('#container');\n *\n * var dropHandler = fileDrop(handleFiles);\n *\n * node.addEventListener('dragover', dropHandler);\n *\n * @param {String} [label='Drop files here']\n * @param {Function} fn\n *\n * @return {Function} drag start callback function\n */\nexport default function fileDrop(label, fn) {\n\n  if (typeof label === 'function') {\n    fn = label;\n    label = 'Drop files here';\n  }\n\n  var self;\n  var extraArgs;\n\n  // we are bound, if overlay exists\n  var overlay;\n\n  function onDrop(event) {\n\n    event.preventDefault();\n\n    asyncMap(event.dataTransfer.files, readFile, function(err, files) {\n\n      if (err) {\n        console.warn('file drop failed', err);\n      } else {\n\n        var args = extraArgs.concat([ files, event ]);\n\n        // cleanup on drop\n        // onEnd(event);\n\n        // call provided fn with extraArgs..., files, event\n        fn.apply(self, args);\n      }\n    });\n  }\n\n  function isDragAllowed(dataTransfer) {\n\n    if (!dataTransfer || !dataTransfer.items.length) {\n      return false;\n    }\n\n    var hasFile = false;\n\n    for (var i = 0; i < dataTransfer.items.length; i++) {\n      if (dataTransfer.items[i].type === 'file' || dataTransfer.items[i].kind === 'file') {\n        hasFile = true;\n      }\n    }\n\n    return hasFile;\n  }\n\n  function onDragover() {\n\n    // (0) extract extra arguments (extraArgs..., event)\n    var args = slice(arguments),\n        event = args.pop();\n\n    var dataTransfer = event.dataTransfer,\n        target = event.currentTarget || event.target;\n\n    if (!isDragAllowed(dataTransfer)) {\n      return;\n    }\n\n    // make us a drop zone\n    event.preventDefault();\n\n    dataTransfer.dropEffect = 'copy';\n\n    // only register if we do not drag and drop already\n    if (overlay) {\n      return;\n    }\n\n    overlay = createOverlay(label);\n\n    target.appendChild(overlay);\n\n    self = this;\n    extraArgs = args;\n\n\n    // do not register events during testing\n    if (!target) {\n      return;\n    }\n\n\n    // (2) setup drag listeners\n\n    function onLeave(event) {\n\n      var relatedTarget = event.relatedTarget;\n\n      if (target.contains(relatedTarget)) {\n        return;\n      }\n\n      onEnd(event);\n    }\n\n    // (2.1) detach on end\n    function onEnd(event) {\n\n      document.removeEventListener('drop', onDrop);\n      document.removeEventListener('drop', onEnd);\n      document.removeEventListener('dragleave', onLeave);\n      document.removeEventListener('dragend', onEnd);\n      document.removeEventListener('dragover', preventDrop);\n\n      if (overlay) {\n        target.removeChild(overlay);\n        overlay = null;\n      }\n    }\n\n    // (2.0) attach drag + cleanup event\n    document.addEventListener('drop', onDrop);\n    document.addEventListener('drop', onEnd);\n    document.addEventListener('dragleave', onLeave);\n    document.addEventListener('dragend', onEnd);\n    document.addEventListener('dragover', preventDrop);\n  }\n\n  onDragover.onDrop = onDrop;\n\n  return onDragover;\n}\n\n\n// helpers ////////////////////////////////////\n\nfunction readFile(dropFile, done) {\n\n  if (!window.FileReader) {\n    return done();\n  }\n\n  var reader = new FileReader();\n\n  // Closure to capture the file information.\n  reader.onload = function(e) {\n\n    done(null, {\n      name: dropFile.name,\n      path: dropFile.path,\n      contents: e.target.result\n    });\n  };\n\n  reader.onerror = function(event) {\n    done(event.target.error);\n  };\n\n  // Read in the image file as a data URL.\n  reader.readAsText(dropFile);\n}\n\n\nfunction asyncMap(elements, iterator, done) {\n\n  var idx = 0,\n      results = [];\n\n  function next() {\n\n    if (idx === elements.length) {\n      done(null, results);\n    } else {\n\n      iterator(elements[idx], function(err, result) {\n\n        if (err) {\n          return done(err);\n        } else {\n          results[idx] = result;\n          idx++;\n\n          next();\n        }\n      });\n    }\n  }\n\n  next();\n}\n\nfunction slice(arr) {\n  return Array.prototype.slice.call(arr);\n}\n\nfunction createOverlay(label) {\n  var markup = OVERLAY_HTML.replace('{label}', label);\n\n  return domify(markup);\n}\n\nfunction preventDrop(event) {\n  event.preventDefault();\n}"],"names":[],"mappings":"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"}